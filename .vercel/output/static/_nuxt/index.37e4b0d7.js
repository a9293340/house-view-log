import{_ as O}from"./index.9afb9fe1.js";import{r as x,H as G,I as Z,J as H,E as R,K as q,L as J,m as f,q as y,M as A,y as P,t as V,N as Q,O as B,c as v,i as z,s as h,P as c,v as d,x as L,Q as g,R as b,S as W,T as X,z as Y,A as ee,U as oe,V as te}from"./entry.5836a4c5.js";import{_ as D}from"./_plugin-vue_export-helper.c27b6911.js";const U=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function ne(e,l){if(typeof e!="string")throw new TypeError("argument str must be a string");const r={},s=(l||{}).decode||ae;let n=0;for(;n<e.length;){const o=e.indexOf("=",n);if(o===-1)break;let i=e.indexOf(";",n);if(i===-1)i=e.length;else if(i<o){n=e.lastIndexOf(";",o-1)+1;continue}const p=e.slice(n,o).trim();if(r[p]===void 0){let m=e.slice(o+1,i).trim();m.codePointAt(0)===34&&(m=m.slice(1,-1)),r[p]=ie(m,s)}n=i+1}return r}function M(e,l,r){const t=r||{},s=t.encode||re;if(typeof s!="function")throw new TypeError("option encode is invalid");if(!U.test(e))throw new TypeError("argument name is invalid");const n=s(l);if(n&&!U.test(n))throw new TypeError("argument val is invalid");let o=e+"="+n;if(t.maxAge!==void 0&&t.maxAge!==null){const i=t.maxAge-0;if(Number.isNaN(i)||!Number.isFinite(i))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(i)}if(t.domain){if(!U.test(t.domain))throw new TypeError("option domain is invalid");o+="; Domain="+t.domain}if(t.path){if(!U.test(t.path))throw new TypeError("option path is invalid");o+="; Path="+t.path}if(t.expires){if(!se(t.expires)||Number.isNaN(t.expires.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+t.expires.toUTCString()}if(t.httpOnly&&(o+="; HttpOnly"),t.secure&&(o+="; Secure"),t.priority)switch(typeof t.priority=="string"?t.priority.toLowerCase():t.priority){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(t.sameSite)switch(typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o}function se(e){return Object.prototype.toString.call(e)==="[object Date]"||e instanceof Date}function ie(e,l){try{return l(e)}catch{return e}}function ae(e){return e.includes("%")?decodeURIComponent(e):e}function re(e){return encodeURIComponent(e)}const ce={path:"/",watch:!0,decode:e=>q(decodeURIComponent(e)),encode:e=>encodeURIComponent(typeof e=="string"?e:JSON.stringify(e))};function le(e,l){var n;const r={...ce,...l},t=ue(r)||{},s=x(t[e]??((n=r.default)==null?void 0:n.call(r)));{const o=typeof BroadcastChannel>"u"?null:new BroadcastChannel(`nuxt:cookies:${e}`);G()&&Z(()=>{o==null||o.close()});const i=()=>{pe(e,s.value,r),o==null||o.postMessage(J(s.value))};let p=!1;o&&(o.onmessage=m=>{p=!0,s.value=m.data,H(()=>{p=!1})}),r.watch?R(s,()=>{p||i()},{deep:r.watch!=="shallow"}):i()}return s}function ue(e={}){return ne(document.cookie,e)}function de(e,l,r={}){return l==null?M(e,l,{...r,maxAge:-1}):M(e,l,r)}function pe(e,l,r={}){document.cookie=de(e,l,r)}const me={__name:"ErrorMsg",props:{msg:{type:String,default:""},check:{type:Boolean,default:!1}},setup(e){const l=e;return(r,t)=>{const s=O;return f(),y("p",{class:Q({"not-right":!l.check})},[l.check?(f(),A(s,{key:0,class:"mr-3",color:"green",size:24,icon:"material-symbols:check-circle-outline"})):(f(),A(s,{key:1,class:"mr-3",color:"red",size:24,icon:"mi:circle-error"})),P(" "+V(l.msg),1)],2)}}},w=D(me,[["__scopeId","data-v-3bc40837"]]);const fe=e=>(Y("data-v-cd8508d9"),e=e(),ee(),e),ge={class:"title"},ye={class:"p"},he={key:0,class:"double-check"},ke={key:2,class:"double-check"},_e={class:"login-validation"},ve={class:"new-admin"},we=fe(()=>h("p",null,"忘記密碼",-1)),xe={__name:"index",props:{desc:{type:String,default:""},loginType:{type:String,default:"L"}},emits:["loginGo","types"],setup(e,{emit:l}){const r=e,{setErrorLog:t}=B(),s=v(()=>r.loginType),n=x({account:"",password:"",doubleCheck:""}),o=v(()=>/[A-Z]/.test(n.value.password)),i=v(()=>/[a-z]/.test(n.value.password)),p=v(()=>/\d/.test(n.value.password)),m=v(()=>/[a-zA-Z\d]{8,}/.test(n.value.password)),S=v(()=>n.value.password===n.value.doubleCheck&&n.value.password!==""&&n.value.doubleCheck!==""),C=x(!0),k=x(null),E=x(null);R(n.value,async _=>{const a=await $fetch("/api/admin/check",{method:"POST",body:{account:_.account}});C.value=a.length===0});const F=_=>E.value=_,I=_=>{l("types",_)},$=()=>{if(E.value){if(!k.value||E.value.toUpperCase()!==k.value.toUpperCase()){t({title:"輸入錯誤!",type:"error",description:"請檢察輸入內容"});return}if(r.loginType==="N"){if(!C.value){t({title:"輸入錯誤!",type:"error",description:"帳號已被使用"});return}if(!S.value){t({title:"輸入錯誤!",type:"error",description:"密碼重複驗證失敗"});return}if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(n.value.password)){t({title:"輸入錯誤!",type:"error",description:"密碼不符合規範"});return}}l("loginGo",{user:{...n.value},type:s.value})}};return(_,a)=>{const N=O,T=z("el-input"),K=z("VueClientRecaptcha"),j=z("el-button");return f(),y(X,null,[h("div",ge,V(c(s)==="L"?"登入":"註冊"),1),h("div",ye,V(r.desc),1),d(T,{size:"large",class:"login-input",placeholder:c(s)==="L"?"請填入帳號":"請輸入想申請之帳號",modelValue:c(n).account,"onUpdate:modelValue":a[0]||(a[0]=u=>c(n).account=u),modelModifiers:{trim:!0},autocomplete:"off"},{prepend:L(()=>[d(N,{color:"black",size:28,icon:"mdi-account",class:"mr-2"})]),_:1},8,["placeholder","modelValue"]),c(s)==="N"?(f(),y("div",he,[d(w,{msg:"帳號可用",check:c(C),"onUpdate:check":a[1]||(a[1]=u=>g(C)?C.value=u:null)},null,8,["check"])])):b("",!0),d(T,{type:"password",size:"large",class:"login-input",placeholder:c(s)==="L"?"請填入密碼":"密碼須至少8碼並包含大小寫跟數字各至少一個",modelValue:c(n).password,"onUpdate:modelValue":a[2]||(a[2]=u=>c(n).password=u),modelModifiers:{trim:!0},autocomplete:"off"},{prepend:L(()=>[d(N,{color:"black",size:24,icon:"mdi-password",class:"mr-2"})]),_:1},8,["placeholder","modelValue"]),c(s)!=="L"?(f(),A(T,{key:1,type:"password",size:"large",class:"login-input",placeholder:"請再次輸入密碼",modelValue:c(n).doubleCheck,"onUpdate:modelValue":a[3]||(a[3]=u=>c(n).doubleCheck=u),modelModifiers:{trim:!0},autocomplete:"off"},{prepend:L(()=>[d(N,{color:"black",size:24,icon:"mdi-password",class:"mr-2"})]),_:1},8,["modelValue"])):b("",!0),c(s)==="N"?(f(),y("div",ke,[d(w,{msg:"包含一個大寫",check:c(o),"onUpdate:check":a[4]||(a[4]=u=>g(o)?o.value=u:null)},null,8,["check"]),d(w,{msg:"包含一個小寫",check:c(i),"onUpdate:check":a[5]||(a[5]=u=>g(i)?i.value=u:null)},null,8,["check"]),d(w,{msg:"包含一個數字",check:c(p),"onUpdate:check":a[6]||(a[6]=u=>g(p)?p.value=u:null)},null,8,["check"]),d(w,{msg:"總數8碼",check:c(m),"onUpdate:check":a[7]||(a[7]=u=>g(m)?m.value=u:null)},null,8,["check"]),d(w,{msg:"密碼重複輸入正確",check:c(S),"onUpdate:check":a[8]||(a[8]=u=>g(S)?S.value=u:null)},null,8,["check"])])):b("",!0),h("div",_e,[d(T,{class:"validation-input",size:"default",placeholder:"請填入驗證碼",modelValue:c(k),"onUpdate:modelValue":a[9]||(a[9]=u=>g(k)?k.value=u:null),modelModifiers:{trim:!0},autocomplete:"off",onKeyup:W($,["enter","native"])},null,8,["modelValue","onKeyup"]),d(K,{value:c(k),onGetCode:F},null,8,["value"])]),d(j,{class:"login-btn",onClick:$},{default:L(()=>[P(V(c(s)==="L"?"登入":"註冊"),1)]),_:1}),h("div",ve,[c(s)==="L"?(f(),y("p",{key:0,onClick:a[10]||(a[10]=u=>I("N"))},"新增帳號")):b("",!0),c(s)==="N"?(f(),y("p",{key:1,onClick:a[11]||(a[11]=u=>I("L"))},"登入")):b("",!0),we])],64)}}},Ce=D(xe,[["__scopeId","data-v-cd8508d9"]]),be=""+new URL("login-1.9e1d133e.jpg",import.meta.url).href;const Se={class:"blur-img"},Te={class:"login"},Ee={__name:"index",setup(e){const{setErrorLog:l}=B(),r=le("house-view",{maxAge:60*60*24}),t=x("L"),s=o=>{t.value=o},n=async o=>{if(console.log(o),o.type==="N"){const i=await $fetch("/api/admin/create",{method:"POST",body:{account:o.user.account,password:o.user.password}});console.log(i),te.alert("新增帳號成功","提醒",{confirmButtonText:"OK!"}).then(()=>{s("L")})}else{const i=await $fetch("/api/admin/login",{method:"POST",body:{account:o.user.account,password:o.user.password}});console.log(i),i.status?l({title:"Login Failed!",type:"error",description:"帳號/密碼錯誤或不存在"}):r.value=i.token}};return(o,i)=>{const p=Ce;return f(),y("div",{class:"login",style:oe(`background-image: url(${c(be)})`)},[h("div",Se,[h("div",Te,[d(p,{loginType:c(t),"onUpdate:loginType":i[0]||(i[0]=m=>g(t)?t.value=m:null),desc:"這是一個關於看房記事本的網頁",onLoginGo:n,onTypes:s},null,8,["loginType"])])])],4)}}};export{Ee as default};
